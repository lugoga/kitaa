{
  "hash": "26f322bd0fc4150f587e860d47fb2a42",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mapped: the bathymetry of WIO-Region\"\ndescription: \"Creating a Map of the Western Indian Ocean Region with Bathymetry and Country Labels in R\"\nauthor: \n  - name: Masumbuko Semba\n    url: https://semba.netlify.app\n    orcid: 0000-0002-5002-9747\n    affiliation: Nelson Mandela African Institution of Science and Technology\n    affiliation-url: https://semba.netlify.app/  \ncitation: \n    url: https://lugoga.github.io/kitaa/posts/mapping_wio/\nbibliography: ../blog.bib\ncsl:  ../elsevier.csl\ndate: \"2024-07-24\"\ntoc: true\ntoc-depth: 4\ncategories: [Mapping, Data Visualization, ggplot]\nimage: map.png\ncode-fold: false\nexecute: \n  warning: false\n  message: false\n  comment: \"\"\n  \nfilters: \n  - webr\n\n---\n\n\n\n\n<!-- Google tag (gtag.js) -->\n<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-8KY4TDP558\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'G-8KY4TDP558');\n</script>\n\n\n\n\n## Introduction\n\nMapping the western Indian Ocean region with bathymetry and country labels can provide valuable insights into the geographical and topographical features of the area. Using R, we can achieve this by leveraging powerful libraries such as ggplot2, sf, rnaturalearth, and marmap. This allows for the creation of detailed maps that showcase the underwater terrain, coastlines, and political boundaries of the region, enabling a deeper understanding of its physical geography.\n\nFirst, we need to load the required packages. These packages will provide the necessary functions and datasets to create our map. If the packages are not installed, please install them first before loading them in the session\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(tidyverse)\nrequire(sf)\nrequire(rnaturalearth)\nrequire(rnaturalearthdata)\nrequire(marmap)\nrequire(terra)\nrequire(tidyterra)\nrequire(magrittr)\nrequire(ggforce)\n```\n:::\n\n\n\n## Define Map Extent\n\nThen we define the geographic extent of a map by specifying the minimum and maximum longitudes and latitudes. This step is important for focusing the map specifically on the western Indian Ocean region. By setting these boundaries, the map will display only the area within the specified coordinates, allowing for a targeted visualization of the desired region. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlon_min = 20\nlon_max = 80\nlat_min = -40\nlat_max = 20\n```\n:::\n\n\n\n## Get Bathymetry Data\n\nWe then use he `getNOAA.bathy` function from the **marmap** package [@marmap] to retrieve bathymetry data (underwater topography) for the region, and the resolution parameter sets the resolution of the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbathy = getNOAA.bathy(\n  lon1 = lon_min, lon2 = lon_max, \n  lat1 = lat_min, lat2 = lat_max, \n  resolution = 10\n  )\n```\n:::\n\n\n\n\n## Convert Bathymetry Data to Data Frame\n\nThe bathymetry data obtained from the NOAA dataset is in matrix form. To plot it with **ggplot2** package [@ggplot], we need to convert it to a data frame or raster. This makes it easier to work with in the context of plotting functions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert bathymetry data to a data frame\nbathy_df = marmap::as.xyz(bathy = bathy) |> \n  rename(lon = 1, lat = 2, elevation = 3) |> \n  as_tibble()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## Convert the bathymetry data to raster\n\nbathy.rast = bathy |>\n  marmap::as.raster() |> \n  rast()\n\nbathy.rast[bathy.rast > 0] = NA\n```\n:::\n\n\n\n\n## Get World Map Data and Crop to Extent\n\nWe retrieve world map data using the `ne_countries` function from the **rnaturalearth** package [@rnaturalearth]. This function returns spatial data for world countries. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld = ne_countries(\n  scale = \"medium\", \n  returnclass = \"sf\"\n  )\n```\n:::\n\n\nWe then crop this data to the desired map extent using the `st_crop` function from the **sf** package [@sf].\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_cropped = world |> \n  select(name, pop = pop_est, gdp = gdp_md, economy, income_grp) |> \n  st_crop(\n    xmin = lon_min, xmax = lon_max, \n    ymin = lat_min, ymax = lat_max\n    )\n```\n:::\n\n\nThen we filter the countries that are within the Western Indian Ocean region. We use `filter` function from **dplyr** package [@dplyr] to pick ten countries in the region.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwio.sf = world_cropped |> \n  filter(name %in% c(\"Somalia\", \"Kenya\", \"Tanzania\", \"Mozambique\", \"South Africa\", \"Madagascar\", \"Seychelles\", \"Comoros\", \"Mauritius\", \"Reunion\"))\n```\n:::\n\n\n\n## Create a labels and description\n\nThen we create a tibble derived from the simple feature that contains coordinates (latitude and longitude) and description of population and economy for each country in the region\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwio.tb = wio.sf |> \n  st_centroid() |> \n  st_coordinates() |> \n  as_tibble() |> \n  select(lon = 1, lat = 2) |> \n  bind_cols(\n    wio.sf |> \n      st_drop_geometry() |> \n      separate(economy, into = c(\"a\", \"economy\"), sep = 2) |> \n      separate(income_grp, into = c(\"a\", \"income_grp\"), sep = 2) |> \n      select(-a) |> \n      mutate(\n        name = str_to_upper(name),\n        description = paste0(\n          \"Population: \", scales::number(pop, big.mark = \",\"),\"\\n\",\n          \"Income group: \", income_grp\n          )\n        )\n)\n```\n:::\n\n\n## Plot the Map with Bathymetry\nWe use ggplot2 to generate the map. The geom_raster function is employed to plot the bathymetry data, employing a color gradient to represent varying depth. The `geom_sf` function is used to plot the country boundaries, and the `coord_sf` function ensures the map is plotted within the defined geographic extent. The `geom_mark_circle` function from **ggforce** package [@ggforce] is then used to add these labels to the map. This enhances the map by providing clear, readable labels for key countries in the region.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_spatraster(data = bathy.rast) +\n  geom_spatraster_contour(data = bathy.rast, breaks = -600) +\n  ggspatial::layer_spatial(data = world_cropped, fill = \"grey70\", color = \"white\") +\n  ggspatial::layer_spatial(data = wio.sf, fill = \"palegreen4\", color = \"white\") +\n  ggforce::geom_mark_circle(\n    data = wio.tb,\n    aes(x = lon, y = lat, label = name, group = name, description = description),\n    show.legend=F, fill = \"white\",\n    alpha=0.8,\n    label.fontsize = 9,\n    label.fill = \"grey85\", \n    position = \"jitter\", \n    con.type = \"elbow\",\n    label.buffer = unit(8, \"mm\"), \n    expand = unit(2.5, \"mm\"),\n    con.cap = unit(.8, \"mm\"), \n    con.size = unit(.5, \"mm\"),\n    con.colour = \"black\")+\n  geom_point(data = wio.tb, aes(x = lon, y = lat), size = 2) +\n  ggspatial::annotation_scale(location =  \"bl\")+\n  ggspatial::annotation_north_arrow(\n    location = \"tr\", width = unit(6, \"mm\"), height = unit(6, \"mm\")) +\n  coord_sf(xlim = c(25,65), ylim = c(-35,15))+\n  scale_fill_gradientn(\n    name = \"Depth (m)\",\n    colours=c(\"#5e24d6\",\"#22496d\",\"#042f66\",\"#054780\",\"#1074a6\",\n              \"#218eb7\",\"#48b5d2\",\"#72d0e1\",\"#9ddee7\",\"#c6edec\"),\n    breaks=seq(0,-7000,-1000),\n    labels=seq(0,7000,1000),\n    trans = scales::modulus_trans(p = .6),\n    na.value = NA)+\n  theme_bw(base_size = 10)+\n  theme(\n    panel.background = element_blank(), # bg of the panel\n    panel.grid.major = element_line(linetype = \"dotted\", colour=\"grey30\",linewidth=0.15),\n    panel.ontop = TRUE,\n    panel.grid.minor = element_blank(),\n    panel.border = element_rect(colour = \"black\", fill=NA, linewidth=1),\n    axis.title = element_blank(),\n    legend.position = c(0.90,.18)\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=768}\n:::\n:::\n\n\n## Conclusion\n\nThis map offers valuable geographical and topographical insights, making it useful for various applications in research, education, and more. Adjust the coordinates and resolution as needed for more detailed or broader plotting, and feel free to customize the map further to suit your specific needs. By following these steps, you can create any detailed map of interest that includes both seafloor depth and country labels.\n\n\n## References\n\n\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}