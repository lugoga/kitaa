{
  "hash": "eebb2ed289e48415c3c79cbf0006b39d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualize percentage change of catch landings using arrows in ggplot2\"\ndescription: \"The post takes step-by-step on generating a arrow line plot using ggplot2 in R to visualize how the capture fisheries landing has increased or decreased between 2000 and 2018 It also illustrate how to annotate the percenatage change for each country\"\nauthor: \n  - name: Masumbuko Semba\n    url: https://semba.netlify.app\n    orcid: 0000-0002-5002-9747\n    affiliation: Nelson Mandela African Institution of Science and Technology\n    affiliation-url: https://semba.netlify.app/  \ncitation: \n    url: https://lugoga.github.io/kitaa/posts/visualize_arrow/\nbibliography: ../blog.bib\ncsl:  ../elsevier.csl\ndate: \"2024-06-06\"\ntoc: true\ntoc-depth: 4\ncategories: [Data Science, Data Visualization, ggplot]\nimage: theplot.png\ncode-fold: false\nexecute: \n  warning: false\n  message: false\n  comment: \"\"\nfilters: \n  - webr\n---\n\n\n\n\n<!-- Google tag (gtag.js) -->\n<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-8KY4TDP558\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'G-8KY4TDP558');\n</script>\n\n\n\n\n## Introduction\n\n\nThis post visualizes the changes in the proportion of catch landings in national fisheries from 2000 to 2018, using faceted arrow plots created with the ggplot2 library in R. The post covers various techniques for customizing the plot, such as drawing arrows, handling aesthetics inheritance, creating unique annotations in selected faceted panels, and controlling annotation alignment and plot margins. First, let's load the necessary libraries and the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(tidyverse)\nrequire(rfisheries)\nrequire(magrittr)\n\ntheme_set(theme_minimal(base_size = 15)) # global theme\n```\n:::\n\n\n\nThen download the catch data for each country\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfisheries = bind_rows(\nrfisheries::of_landings(country = \"TZA\"),\nrfisheries::of_landings(country = \"KEN\"),\nrfisheries::of_landings(country = \"UGA\"),\nrfisheries::of_landings(country = \"EAZ\"),\nrfisheries::of_landings(country = \"MOZ\"),\nrfisheries::of_landings(country = \"MDG\"),\nrfisheries::of_landings(country = \"MUS\"),\nrfisheries::of_landings(country = \"NGA\"),\nrfisheries::of_landings(country = \"LBR\"),\nrfisheries::of_landings(country = \"LBY\"),\nrfisheries::of_landings(country = \"ETH\"),\nrfisheries::of_landings(country = \"EGY\"),\nrfisheries::of_landings(country = \"DJI\"),\nrfisheries::of_landings(country = \"TCD\"),\nrfisheries::of_landings(country = \"BEN\"),\nrfisheries::of_landings(country = \"AGO\"),\nrfisheries::of_landings(country = \"DZA\")\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfisheries |> FSA::headtail(n = 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     year    catch country\n1    1950  32600.0     TZA\n2    1951  32600.0     TZA\n3    1952  35600.0     TZA\n4    1953  60000.0     TZA\n5    1954  59900.0     TZA\n1169 2014  97828.0     DZA\n1170 2015  95946.0     DZA\n1171 2016 100180.0     DZA\n1172 2017 104100.1     DZA\n1173 2018 115255.0     DZA\n```\n\n\n:::\n:::\n\n\nThe dataset `d.long` has been prepared to contain data for the years 2000 and 2018, excluding information related to Nigeria. The year column has been converted to a factor, which means it is now treated as a categorical variable rather than a numerical one. This dataset is now in a suitable format for conducting additional analysis or visualization tasks. For example, it can be used to create faceted arrow plots, which are a type of data visualization that allows for comparison and analysis of multiple variables across different categories or factors. Overall, the d.long dataset is now well-prepared for further exploration and interpretation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd.long = fisheries |> \n  filter(year %in% c(2000,2018) & !country == \"NGA\") |> \n  mutate(year = as.factor(year))\n```\n:::\n\n\n\nThen, transform the `d.long` dataset into a wide format, clean the column names, add new columns to indicate changes and calculations, round numeric values, and create a formatted percentage change label. The result is stored in the `d.wide` dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd.wide = d.long |> \n  pivot_wider(names_from = year, values_from = catch) |> \n  janitor::clean_names()  |> \n  mutate(\n    increased = if_else(x2018 > x2000 , \"Increased\", \"Decreased\"), \n    pct.change = (x2018-x2000)/x2000*100,\n    midpoint = (x2018+x2000)/2\n    ) |> \n  mutate(across(is.numeric, round, 1)) |> \n  mutate(pct_label = paste0(pct.change |> abs(), \"%\"))\n```\n:::\n\n\n\n\n## Visualize\n\n1. Create arrows to indicate the changes in the catch landings from 2000 (start of arrows) to 2018 (end of arrows).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf1 = d.wide |> \n  ggplot()+\n  geom_segment(\n    aes(x = reorder(country, x2018), xend = reorder(country, x2018), y = x2000, yend = x2018, color = increased),\n    arrow = arrow(length = unit(8, \"pt\")), linewidth = 1.2)\nf1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n2. **Flip the axes**\nThe code f2 = f1 + coord_flip(expand = 0, clip = \"off\") modifies the plot f1 by flipping the coordinates, which essentially swaps the x-axis and y-axis. This means that any horizontal elements in the plot become vertical and vice versa. The parameters expand = 0 and clip = \"off\" are used to ensure that there is no additional space around the plot, allowing elements to extend beyond the plot limits if needed. Overall, this modification helps in changing the orientation of the plot to better visualize the data in a different layout.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf2 = f1 +\n  coord_flip(expand = 0, clip = \"off\")\nf2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n3. Enhance color, scale and annotation\n\nThe code `f3 = f2 + further` enhances the plot `f2` in several ways. It adds a custom color scale using `scale_color_manual` and customizes the y-axis with `scale_y_continuous`, positioning it on the right side and formatting the labels using commas. Additionally, the code includes text annotations for percentage change, a title, a subtitle, and a caption, which collectively improve the plot's readability and provide context for better understanding. This customization and annotation of the plot will help viewers interpret the data more effectively and gain insights from the visual representation of the changes in the percentage of seats held by women in national parliaments from 2000 to 2020.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf3 = f2 + \n  scale_color_manual(values = c(\"firebrick4\", \"steelblue4\"))+\n  scale_y_continuous(name = \"Annual landings (tons)\",position = \"right\", labels = scales::label_number(big.mark = \",\"))+\n  geom_text(aes(x = country, y = if_else(increased == \"Increased\", x2018 +20000, x2018-15000), label = pct_label), size = 3.5)+\n  labs(\n    title = \"Catch Landings Changes betwen 2000 and 2018\", \n    subtitle = str_wrap(\n      \"Catch landings in selected African countries show significant fluctuations, with overall trends indicating both increases and decreases.\" \n      ,width = 80\n      ),\n    caption = \"Data sourced from FAO through rfisheries package\")\n\nf3\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n4. Theming\n\nWe can further use theme to customize the visual aspects of the plot by making specific changes to various elements like legends, axis titles, grid lines, axis line style, and the plot's title and subtitle. These alterations aim to improve the overall presentation and aesthetic appeal of the plot in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf3 +\n  theme(\n    legend.title = element_blank(), \n    legend.position = c(.85,.25), \n    axis.title.y = element_blank(),\n    axis.title = element_blank(),\n    panel.grid = element_blank(),\n    # panel.grid.major.y = element_line(linewidth = .1, linetype = \"dashed\"),\n    axis.line.x = element_line(color = \"snow4\"),\n    axis.ticks.x = element_line(color = \"snow4\"),\n    plot.title = element_text(face = \"bold\", size = 15), \n    plot.caption = element_text(size = 10, face = \"italic\"),\n    plot.subtitle = element_text(size = 12, face = \"italic\", color = \"orange4\",\n                                 margin = margin(b = 15))\n    ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n5. The final\n\nTo sum up, the code generates a visually appealing chart that illustrates variations in catch landings from 2000 to 2018 in chosen African nations. Through the use of segmented arrows and personalized annotations, it clearly and aesthetically conveys the fluctuations in yearly landings, demonstrating both rising and falling trends.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd.wide |> \n  ggplot()+\n  geom_segment(\n    aes(x = reorder(country, x2018), xend = reorder(country, x2018), y = x2000, yend = x2018, color = increased),\n    arrow = arrow(length = unit(8, \"pt\")), linewidth = 1.2)+\n  coord_flip()+\n  scale_color_manual(values = c(\"firebrick4\", \"steelblue4\"))+\n  scale_y_continuous(name = \"Annual landings (tons)\",position = \"right\", labels = scales::label_number(big.mark = \",\"))+\n  geom_text(aes(x = country, y = if_else(increased == \"Increased\", x2018 +20000, x2018-15000), label = pct_label), size = 3.5)+\n  labs(\n    title = \"Catch Landings Changes betwen 2000 and 2018\", \n    subtitle = str_wrap(\n      \"Catch landings in selected African countries show significant fluctuations, with overall trends indicating both increases and decreases.\" \n      ,width = 80\n      ),\n    caption = \"Data sourced from FAO through rfisheries package\")+\n  theme(\n    legend.title = element_blank(), \n    legend.position = c(.85,.25), \n    axis.title.y = element_blank(),\n    axis.title = element_blank(),\n    panel.grid = element_blank(),\n    # panel.grid.major.y = element_line(linewidth = .1, linetype = \"dashed\"),\n    axis.line.x = element_line(color = \"snow4\"),\n    axis.ticks.x = element_line(color = \"snow4\"), \n    plot.caption = element_text(size = 10, face = \"italic\"),\n    plot.title = element_text(face = \"bold\", size = 15),\n    plot.subtitle = element_text(size = 12, face = \"italic\", color = \"orange4\",\n                                 margin = margin(b = 15))\n    ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}