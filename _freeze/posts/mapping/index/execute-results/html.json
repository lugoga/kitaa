{
  "hash": "052de71531b9145dfd76c19ca292c35e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Static Map for Publication in R\"\ndescription: \"This blog post takes you through steps you many need to create and generate maps for publication and presentation. \"\nauthor: \n  - name: Masumbuko Semba\n    url: https://semba.netlify.app\n    orcid: 0000-0002-5002-9747\n    affiliation: Nelson Mandela African Institution of Science and Technology\n    affiliation-url: https://semba.netlify.app/  \ncitation: \n    url: https://lugoga.github.io/kitaa/posts/mapping/\nbibliography: ../blog.bib\ncsl:  ../elsevier.csl\ndate: \"2024-07-12\"\ntoc: true\ntoc-depth: 4\ncategories: [Data Science, Data Visualization, ggplot]\nimage: map.png\ncode-fold: false\nexecute: \n  warning: false\n  message: false\n  comment: \"\"\n  \nfilters: \n  - webr\n\n---\n\n\n\n\n<!-- Google tag (gtag.js) -->\n<script async src=\"https://www.googletagmanager.com/gtag/js?id=G-8KY4TDP558\"></script>\n<script>\n  window.dataLayer = window.dataLayer || [];\n  function gtag(){dataLayer.push(arguments);}\n  gtag('js', new Date());\n\n  gtag('config', 'G-8KY4TDP558');\n</script>\n\n\n\n\n## Introduction\n\nThis post provides a detailed step-by-step on how to create maps in R using ggplot2 package. It highlight key aspect such as reading in spatial data to plotting visualizations. It covers various aspects of mapping, including handling coordinate reference systems, dealing with distortions, and integrating different spatial data types such as rasters and vectors, and tables. The post also demonstrates techniques for creating visually appealing and informative maps, including adding labels, scale bars, and custom color palettes. \n\nLet's begin by loading some packages that we need their function of these task. If the packages are not installed, please install them first before loading them in the session\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(tidyverse)\nrequire(sf)\nrequire(patchwork)\nrequire(magrittr)\nrequire(ggforce)\nrequire(cowplot)\nrequire(terra)\nrequire(tidyterra)\n```\n:::\n\n\nLet us begin by creating a data frame with the tibble package in R. This data frame includes information about three notable marine parks: Mafia Island Marine Park (MIMP), Mnazi Bay-Ruvuma Estuary Marine Park (MBREMP), and Tanga Coelacanth Marine Park (TACMAP).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the data frame\nmarine_parks <- tibble(\n  Name = c(\"MIMP\", \"MBREMP\", \"TACMAP\"),\n  name = c(\"Mafia Island \\nMarine Park\", \"Mnazi Bay-Ruvuma \\nEstuary Marine Park\", \"Tanga Coelacanth \\nMarine Park\"),\n  Latitude = c(-7.8257, -10.4244, -5.044),\n  Longitude = c(39.7586, 40.4743, 39.042),\n  Description = c(\n    \"Is known for its rich marine biodiversity, including coral reefs, mangroves, and seagrass beds.\",\n    \"Has a variety of marine habitats including coral reefs, seagrass beds, and mangroves.\",\n    \"Is famous for being home to the coelacanth, a rare and ancient species of fish.\"\n  )\n) |> \n  janitor::clean_names()\n```\n:::\n\n\n\nThe we load basemaps. First, I load a geopackage file containing geographical data for Africa into the africa object using the `st_read()` function. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nafrica = st_read(\"africa_wgs84.gpkg\", quiet = T)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nNext, I read a bathymetry file, which contains underwater depth data, into the bathy object using the `rast()` function. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nbathy = rast(\"wioregio-7753.asc\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nI then crop the bathymetry data to focus on the region within the coordinates (37, 45, -13, -1), covering parts of Tanzania, and rename the depth column in the resulting bathy.tz object. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nbathy.tz = bathy |> \n  crop(ext(c(37,45,-13,-1))) |> \n  rename(depth = 1)\n```\n:::\n\n\nFinally, I set any positive depth values (indicating land areas) to NA, ensuring that only underwater features are retained in the bathy.tz dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbathy.tz[bathy.tz > 0] = NA\n```\n:::\n\n\n\n### Main map\n\nThen we map the Marine Parks along the coastal waters of Tanzania superimposed on bathymetry and land layer (@fig-map. First, the code creates a base map using ggplot() and spatial packages like ggspatial. It adds a layer of Africa (africa) filled with light green color and a grey border. Bathymetry data bathy.tz. The code uses two geomtries (geom_spatraster and geom_spatraster_contour) to represent bathymetry as a colored grid and black contour lines. The color gradient is set based on depth, going from light blue (shallow) to dark blue (deep). Marine parks  are added as circles using `geom_mark_circle` over these locations. Each circle has a label showing the park name and a black connecting line. Labels, scale bars, and custom color palettes are added to enhance the appearance and readability of the final map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig.main =   ggplot() +\n  geom_spatraster(data = bathy.tz) + \n  geom_spatraster_contour(data = bathy.tz, breaks = c(-200), color = \"black\") +\n  # geom_spatraster_contour_text(data = bathy.tz, aes(label = depth), breaks = c(-200, -2000), color = \"black\", ) +\n  ggspatial::layer_spatial(data = africa, fill = \"palegreen4\", color = \"grey30\") +\n  ggforce::geom_mark_circle(\n    data = marine_parks, \n    aes(x = longitude, y = latitude, label = name, group = name, description = description), \n    show.legend=F,\n    alpha=0.8,\n    label.fontsize = 10,\n    # label.minwidth = unit(5.25, \"mm\"),\n    label.buffer = unit(8, \"mm\"),\n    label.fill = \"ivory\", \n    con.size = unit(.5, \"mm\"), \n    con.cap = unit(.5, \"mm\"),\n    con.type = \"elbow\", \n    con.colour = \"black\")+\n  coord_sf(xlim = c(38,42.5), ylim = c(-11.2,-4))+\n  scale_fill_gradientn(name = \"Depth (m)\",\n                       colours=c(\"#5e24d6\",\"#22496d\",\"#042f66\",\"#054780\",\"#1074a6\",\n                                \"#218eb7\",\"#48b5d2\",\"#72d0e1\",\"#9ddee7\",\"#c6edec\"),\n                       breaks=c(0,-200,-500,-1000,-2000,-4000),\n                       labels=c(0,200,500,1000,2000,4000),\n                       trans = scales::modulus_trans(p = .4),\n                       na.value = NA)+\n  ggspatial::annotation_north_arrow(location = \"tr\", width = unit(.8, \"cm\"), height = unit(.8, \"cm\")) +\n  ggspatial::annotation_scale(location = \"bl\")+\n  theme_bw(base_size = 10)+\n  theme(\n    panel.background = element_blank(), # bg of the panel\n    panel.grid.major = element_line(linetype = \"dotted\", colour=\"grey30\",linewidth=0.15),\n    panel.ontop = TRUE,\n    panel.grid.minor = element_blank(),\n    panel.border = element_rect(colour = \"black\", fill=NA, linewidth=1),\n    axis.title = element_blank(), \n    legend.title = element_text(size = 10),\n    legend.text = element_text(size = 9),\n    legend.background = element_rect(colour = \"black\", linewidth = .3),\n    legend.position = c(0.12,.15)\n    )\n  \nfig.main\n```\n\n::: {.cell-output-display}\n![The coastal and marine waters of Tanzani with major marine parks](index_files/figure-html/fig-map-1.png){#fig-map width=768}\n:::\n:::\n\n\nWe can conclude our mapping exercise by creating a multi-panel map using the patchwork package, allowing for detailed zoomed-in views of specific regions. let's first create subset maps for Mafia Island Marine Park, Mnazi Bay-Ruvuma Estuary Marine Park, Tanga Coelacanth Marine Park\n\n### Mnazi Bay\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig.mt = ggplot() +\n  geom_spatraster(data = bathy.tz) + \n  geom_spatraster_contour_text(data = bathy.tz, breaks = -200) + \n  ggspatial::layer_spatial(data = africa, fill = \"#689868\")  +\n  ggforce::geom_mark_circle(\n    data = marine_parks, \n    aes(x = longitude, y = latitude, label = name, group = name),\n    show.legend=F,\n    alpha=0.8,\n    label.fontsize = 6,\n    label.buffer = unit(0.5, \"mm\"),\n    expand = unit(0.5, \"mm\") , \n    radius = unit(1.5, \"mm\") ,\n    label.fill = \"ivory\", con.type = \"elbow\", con.colour = \"black\")+\n  coord_sf(xlim = c(40,40.8), ylim = c(-10.8,-10.2))+\n  scale_fill_gradientn(colours=c(\"#5e24d6\",\"#22496d\",\"#042f66\",\"#054780\",\"#1074a6\",\n                                \"#218eb7\",\"#48b5d2\",\"#72d0e1\",\"#9ddee7\",\"#c6edec\"),\n                       # breaks=c(0,-2500,-5000,-7500),\n                       # labels=c(\"0\",\"2,500\",\"5,000\",\"7,500\"),\n                       trans = scales::modulus_trans(p = .4),\n                       na.value = NA)+\n  theme_bw(base_size = 10)+\n  theme(\n    panel.background = element_blank(), # bg of the panel\n    panel.grid.major = element_blank(),\n    panel.ontop = TRUE,\n    panel.grid.minor = element_blank(),\n    panel.border = element_rect(colour = \"black\", fill=NA, linewidth=1),\n    axis.title = element_blank(),\n    axis.text = element_blank(),\n    axis.ticks = element_blank(),\n    legend.position = \"none\"\n    )\n```\n:::\n\n\n### Mafia Island Marine Park\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig.mafia = ggplot() +\n  geom_spatraster(data = bathy.tz) + \n  geom_spatraster_contour_text(data = bathy.tz, breaks = -200) + \n  ggspatial::layer_spatial(data = africa, fill = \"#689868\")  +\n  ggforce::geom_mark_circle(\n    data = marine_parks, \n    aes(x = longitude, y = latitude, label = name, group = name),\n    show.legend=F,\n    alpha=0.8,\n    label.fontsize = 6,\n    label.buffer = unit(0.5, \"mm\"),\n    expand = unit(0.5, \"mm\") , \n    radius = unit(1.5, \"mm\") ,\n    label.fill = \"ivory\", con.type = \"elbow\", con.colour = \"black\")+\n  coord_sf(xlim = c(39.2,40.), ylim = c(-7.6,-8.2))+\n  scale_fill_gradientn(colours=c(\"#5e24d6\",\"#22496d\",\"#042f66\",\"#054780\",\"#1074a6\",\n                                \"#218eb7\",\"#48b5d2\",\"#72d0e1\",\"#9ddee7\",\"#c6edec\"),\n                       # breaks=c(0,-2500,-5000,-7500),\n                       # labels=c(\"0\",\"2,500\",\"5,000\",\"7,500\"),\n                       trans = scales::modulus_trans(p = .4),\n                       na.value = NA)+\n  theme_bw(base_size = 10)+\n  theme(\n    panel.background = element_blank(), # bg of the panel\n    panel.grid.major = element_blank(),\n    panel.ontop = TRUE,\n    panel.grid.minor = element_blank(),\n    panel.border = element_rect(colour = \"black\", fill=NA, linewidth=1),\n    axis.title = element_blank(),\n    axis.text = element_blank(),\n    axis.ticks = element_blank(),\n    legend.position = \"none\"\n    )\n```\n:::\n\n\n\n### Tanga Coelocanth\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig.pemba = ggplot() +\n  geom_spatraster(data = bathy.tz) + \n  geom_spatraster_contour_text(data = bathy.tz, breaks = -200) + \n  ggspatial::layer_spatial(data = africa, fill = \"#689868\") +\n  ggforce::geom_mark_circle(\n    data = marine_parks, \n    aes(x = longitude, y = latitude, label = name, group = name),\n    show.legend=F,\n    alpha=0.8,\n    label.fontsize = 6,\n    label.buffer = unit(0.5, \"mm\"),\n    expand = unit(0.5, \"mm\") , \n    radius = unit(1.5, \"mm\") ,\n    label.fill = \"ivory\", con.type = \"elbow\", con.colour = \"black\")+\n  coord_sf(xlim = c(38.8,40.), ylim = c(-5.6,-4.5))+\n  scale_fill_gradientn(colours=c(\"#5e24d6\",\"#22496d\",\"#042f66\",\"#054780\",\"#1074a6\",\n                                \"#218eb7\",\"#48b5d2\",\"#72d0e1\",\"#9ddee7\",\"#c6edec\"),\n                       # breaks=c(0,-2500,-5000,-7500),\n                       # labels=c(\"0\",\"2,500\",\"5,000\",\"7,500\"),\n                       trans = scales::modulus_trans(p = .4),\n                       na.value = NA)+\n  theme_bw(base_size = 10)+\n  theme(\n    panel.background = element_blank(), # bg of the panel\n    panel.grid.major = element_blank(),\n    panel.ontop = TRUE,\n    panel.grid.minor = element_blank(),\n    panel.border = element_rect(colour = \"black\", fill=NA, linewidth=1),\n    axis.title = element_blank(),\n    axis.text = element_blank(),\n    axis.ticks = element_blank(),\n    legend.position = \"none\"\n    )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlayout<-c(\n  patchwork::area(t=1,l=1,b=65,r=25),\n  patchwork::area(t=1,l=27,b=25,r=40),\n  patchwork::area(t=26,l=27,b=45,r=40),\n  patchwork::area(t=46,l=27,b=65,r=40)\n)\n\nplot(layout)\n```\n:::\n\n\n### Combined map\n\nThe multi-panel map that combine the main map along with subset for Mafia Island Marine Park, Mnazi Bay-Ruvuma Estuary Marine Park, Tanga Coelacanth Marine Park is presented in @fig-final\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig.main+fig.pemba+fig.mafia+fig.mt +\n  plot_layout(guides = \"collect\",design = layout) +\n  plot_annotation(tag_levels = \"A\") &\n  theme(plot.title = element_text(face = \"bold\",size=25))\n\n# ggsave(\"map.png\", width = 8, height = 8, dpi = 300)\n```\n:::\n\n\n\n![A map of the coastal and marine water of Tanzania with insets for Mafia Island Marine Park, Mnazi Bay-Ruvuma Estuary Marine Park, Tanga Coelacanth Marine Park](map.png){#fig-final}\n\n\n## References\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}